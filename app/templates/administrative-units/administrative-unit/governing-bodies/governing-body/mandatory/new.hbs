{{page-title "Nieuw"}}
{{breadcrumb "Nieuwe mandataris"}}

<div class="au-c-body-container au-c-body-container--scroll">
  <PageHeader class="au-u-margin au-u-margin-bottom-large">
    <:title>Voeg mandataris toe</:title>
    <:subtitle>{{@model.administrativeUnit.name}}</:subtitle>
  </PageHeader>

  {{#if this.isSelectingTargetPerson}}
    <PersonSearch
      @onSelect={{fn (mut this.targetPerson)}}
      @personCreationRedirectUrl={{this.router.currentURL}}
    />
  {{else}}
    <form
      class="au-o-box au-o-flow au-o-flow--large"
      aria-label="minister-position-creation-form"
      {{on "submit" (perform this.createMandatoryPositionTask)}}
    >
      <DataCard>
        <:title>Persoonlijke gegevens</:title>
        <:card as |Card|>
          <Card.Columns>
            <:left as |Item|>
              <Item>
                <:label>
                  Voornaam
                </:label>
                <:content>
                  {{this.targetPerson.givenName}}
                </:content>
              </Item>
            </:left>
            <:right as |Item|>
              <Item>
                <:label>
                  Achternaam
                </:label>
                <:content>
                  {{this.targetPerson.familyName}}
                </:content>
              </Item>
            </:right>
          </Card.Columns>
        </:card>
      </DataCard>

      <EditCard>
        <:title>Contactgegevens</:title>
        <:card as |Card|>
          <Card.Columns>
            <:left as |Item|>
              <AddressSearch
                @address={{@model.address}}
                @itemComponent={{Item}}
              >
                <:manual-address-input>
                  <Item
                    @labelFor="address-street-name"
                    @errorMessage={{@model.address.error.street.validation}}
                  >
                    <:label>Straat</:label>
                    <:content as |errorMessage|>
                      <AuInput
                        @value={{@model.address.street}}
                        @width="block"
                        id="address-street-name"
                        @error={{errorMessage}}
                      />
                    </:content>
                  </Item>
                  <Item
                    @labelFor="address-house-number"
                    @errorMessage={{@model.address.error.number.validation}}
                  >
                    <:label>Huisnummer</:label>
                    <:content as |errorMessage|>
                      <AuInput
                        @value={{@model.address.number}}
                        @width="block"
                        id="address-house-number"
                        @error={{errorMessage}}
                      />
                    </:content>
                  </Item>
                  <Item @labelFor="address-box-number">
                    <:label>Busnummer</:label>
                    <:content>
                      <AuInput
                        @value={{@model.address.boxNumber}}
                        @width="block"
                        id="address-box-number"
                      />
                    </:content>
                  </Item>
                  <Item
                    @labelFor="address-postal-code"
                    @errorMessage={{@model.address.error.postcode.validation}}
                  >
                    <:label>Postcode</:label>
                    <:content as |errorMessage|>
                      <AuInput
                        @value={{@model.address.postcode}}
                        @width="block"
                        id="address-postal-code"
                        @error={{errorMessage}}
                      />
                    </:content>
                  </Item>
                  <Item
                    @labelFor="address-municipality"
                    @errorMessage={{@model.address.error.municipality.validation}}
                  >
                    <:label>Gemeente</:label>
                    <:content as |errorMessage|>
                      <MunicipalitySelect
                        @selected={{@model.address.municipality}}
                        @onChange={{fn (mut @model.address.municipality)}}
                        @id="address-municipality"
                        @error={{errorMessage}}
                      />
                    </:content>
                  </Item>
                </:manual-address-input>
                <:common-input>
                  <Item
                    @labelFor="address-province"
                    @errorMessage={{@model.address.error.province.validation}}
                  >
                    <:label>Provincie</:label>
                    <:content as |errorMessage|>
                      <ProvinceSelect
                        @selected={{@model.address.province}}
                        @onChange={{fn (mut @model.address.province)}}
                        @id="address-province"
                        @error={{errorMessage}}
                      />
                    </:content>
                  </Item>
                </:common-input>
              </AddressSearch>
            </:left>
            <:right as |Item|>
              <Item
                @labelFor="contact-email"
                @errorMessage={{@model.contact.error.email.validation}}
              >
                <:label>E-mail</:label>
                <:content as |errorMessage|>
                  <AuInput
                    @value={{@model.contact.email}}
                    @width="block"
                    @error={{errorMessage}}
                    id="contact-email"
                  />
                </:content>
                <:help-text>
                  {{help-text "email"}}
                </:help-text>
              </Item>
              <Item
                @labelFor="contact-landline"
                @errorMessage={{@model.contact.error.telephone.validation}}
              >
                <:label>Telefoonnummer</:label>
                <:content as |errorMessage|>
                  <AuInput
                    @value={{@model.contact.telephone}}
                    @width="block"
                    @error={{errorMessage}}
                    id="contact-landline"
                  />
                </:content>
                <:help-text>
                  {{help-text "phone-number"}}
                </:help-text>
              </Item>
              <Item
                @labelFor="contact-mobile"
                @errorMessage={{@model.secondaryContact.error.telephone.validation}}
              >
                <:label>GSM nummer</:label>
                <:content as |errorMessage|>
                  <AuInput
                    @width="block"
                    @value={{@model.secondaryContact.telephone}}
                    @error={{errorMessage}}
                    id="contact-mobile"
                  />
                </:content>
                <:help-text>
                  {{help-text "phone-number"}}
                </:help-text>
              </Item>
            </:right>
          </Card.Columns>
        </:card>
      </EditCard>

      <EditCard @containsRequiredFields={{true}}>
        <:title>Mandaat</:title>
        <:card as |Card|>
          <Card.Columns>
            <:left as |Item|>
              <Item
                @labelFor="board-position"
                @required={{true}}
                @errorMessage={{@model.mandatory.error.role.validation}}
              >
                <:label>Bestuursfunctie</:label>
                <:content as |errorMessage|>
                  <MandateRoleSelect
                    @selected={{@model.mandatory.role}}
                    @onChange={{this.handleMandateRoleSelect}}
                    @id="board-position"
                    @error={{errorMessage}}
                  />
                </:content>
              </Item>
              {{#if this.showHalfElectionTypeSelect}}
                <Item
                  @labelFor="half-election-type"
                  @required={{true}}
                  @errorMessage={{@model.mandatory.error.typeHalf.validation}}
                >
                  <:label>Verkozen</:label>
                  <:content as |errorMessage|>
                    <HalfElectionTypeSelect
                      @selected={{@model.mandatory.typeHalf}}
                      @onChange={{fn (mut @model.mandatory.typeHalf)}}
                      @id="half-election-type"
                      @error={{errorMessage}}
                    />
                  </:content>
                </Item>
              {{/if}}
            </:left>
            <:right as |Item|>
              <Item @labelFor="administrative-unit-name">
                <:label>Naam eredienst</:label>
                <:content>
                  <AuInput
                    @value={{@model.administrativeUnit.name}}
                    @width="block"
                    @disabled={{true}}
                  />
                </:content>
              </Item>
            </:right>
          </Card.Columns>
          <Card.Columns>
            <:left as |Item|>
              <Item
                @labelFor="start-date"
                @required={{true}}
                @errorMessage={{@model.mandatory.error.startDate.validation}}
              >
                <:label>Start mandaat</:label>
                <:content as |errorMessage|>
                  <Datepicker
                    @id="start-date"
                    @onChange={{fn (mut @model.mandatory.startDate)}}
                    @value={{@model.mandatory.startDate}}
                    @error={{errorMessage}}
                  />
                </:content>
              </Item>
              {{! TODO: Hide this if the when "lid van rechtswege" is selected }}
              <Item @labelFor="expected-end-date">
                <:label>Geplande einddatum</:label>
                <:content>
                  <Datepicker
                    @id="expected-end-date"
                    @onChange={{fn (mut @model.mandatory.expectedEndDate)}}
                    @value={{@model.mandatory.expectedEndDate}}
                  />
                </:content>
              </Item>
            </:left>
            <:right as |Item|>
              <Item @labelFor="governing-body-period">
                <:label>Bestuursperiode</:label>
                <:content>
                  <AuInput
                    @width="block"
                    @value={{@model.governingBody.period}}
                    @disabled={{true}}
                  />
                </:content>
              </Item>
              <Item
                @labelFor="end-date"
                @required={{not @model.mandatory.isCurrentPosition}}
                @errorMessage={{@model.mandatory.error.endDate.validation}}
              >
                <:label>Effectieve einddatum</:label>
                <:content as |errorMessage|>
                  <Datepicker
                    @id="end-date"
                    @onChange={{this.handleEndDateChange}}
                    @value={{@model.mandatory.endDate}}
                    @error={{errorMessage}}
                  />
                </:content>
              </Item>
              <Item>
                <:content>
                  <AuControlCheckbox
                    checked={{@model.mandatory.isCurrentPosition}}
                    @label="Huidige positie"
                    @identifier="current-position"
                    @onChange={{this.handleIsCurrentPositionChange}}
                  />
                </:content>
              </Item>
              <Item @labelFor="reason-stop">
                <:label>Reden stopzetting </:label>
                <:content>
                  <AuInput
                    @value={{@model.mandatory.reasonStopped}}
                    @width="block"
                    id="reason-stop"
                  />
                </:content>
              </Item>
            </:right>
          </Card.Columns>
        </:card>
      </EditCard>

      <AuButtonGroup>
        <AuButton
          @icon="add"
          @iconAlignment="left"
          @loading={{this.createMandatoryPositionTask.isRunning}}
          @disabled={{this.createMandatoryPositionTask.isRunning}}
          type="submit"
        >
          Voeg toe
        </AuButton>
        <AuLink
          @route="administrative-units.administrative-unit.governing-bodies.governing-body"
          @skin="button-secondary"
        >
          Annuleer
        </AuLink>
      </AuButtonGroup>
    </form>
  {{/if}}
</div>